import os
import sys
THIS_DIR = os.path.dirname(os.path.abspath(__file__))
BASE_DIR = os.path.dirname(THIS_DIR)
sys.path.extend([THIS_DIR, BASE_DIR])

# import pickle
import utils
import pandas as pd
from fuzzywuzzy import process

TERMINAL = {'Grocery store': 1677, 'Restaurant': 1638, 'Mexican restaurant': 1606, 'Clothing store': 1105, 'Fast food restaurant': 895, 'Convenience store': 875, 'Liquor store': 756, 'Furniture store': 591, 'Pizza restaurant': 559, 'Cell phone store': 555, 'Chinese restaurant': 480, 'Hamburger restaurant': 403, 'Shoe store': 399, 'Store': 376, 'Sandwich shop': 348, 'Italian restaurant': 332, 'Thai restaurant': 303, 'Beauty supply store': 300, 'Japanese restaurant': 292, 'American restaurant': 290, 'Drug store': 279, 'Seafood restaurant': 269, 'Sushi restaurant': 263, 'Department store': 255, 'Electronics store': 242, 'Salvadoran restaurant': 238, 'Pet supply store': 232, 'Medical supply store': 227, 'Jewelry store': 211, 'Chicken restaurant': 209, 'Mediterranean restaurant': 205, 'Auto parts store': 200, 'Home goods store': 197, 'Discount store': 196, 'Cosmetics store': 184, 'Thrift store': 164, 'Mattress store': 162, 'Dollar store': 160, 'Hardware store': 156, 'New American restaurant': 152, 'Taco restaurant': 151, 'Sporting goods store': 147, 'Computer store': 137, 'Flooring store': 136, 'Coffee shop': 135, 'Book store': 132, 'Antique store': 131, 'Lighting store': 129, 'Party store': 129, 'Indian restaurant': 119, 'Fabric store': 115, 'Korean restaurant': 114, 'Electrical supply store': 112, 'Vietnamese restaurant': 111, 'Paint store': 110, 'Diner': 110, 'Vintage clothing store': 106, 'Barbecue restaurant': 102, 'Appliance store': 102, 'Cafe': 102, 'Toy store': 99, 'Supermarket': 95, 'Asian fusion restaurant': 94, 'Musical instrument store': 93, 'Cannabis store': 87, 'Shipping and mailing service': 86, 'Bicycle store': 86, 'Home improvement store': 84, 'Fashion accessories store': 82, 'Office supply store': 81, 'Chicken wings restaurant': 80, 'Variety store': 79, 'Tile store': 76, 'Video game store': 74, 'Health food restaurant': 74, 'Health food store': 73, 'Ramen restaurant': 73, 'Hawaiian restaurant': 70, 'Wine store': 69, 'Gift shop': 69, 'Vegan restaurant': 69, 'Uniform store': 68, 'Californian restaurant': 68, 'Pet store': 66, 'Breakfast restaurant': 65, 'Ice cream shop': 64, 'Filipino restaurant': 62, 'Baby store': 61, 'Peruvian restaurant': 59, 'Window treatment store': 57, 'Korean barbecue restaurant': 55, 'Sportswear store': 55, 'Asian restaurant': 53, 'Carpet store': 53, 'Craft store': 52, 'Lingerie store': 52, 'French restaurant': 51, 'Music store': 49, 'Persian restaurant': 47, 'Gastropub': 46, 'Vaporizer store': 45, 'Plumbing supply store': 45, 'Restaurant supply store': 44, 'Steak house': 43, 'Perfume store': 42, 'Family restaurant': 42, 'Mexican grocery store': 41, 'Costume store': 40, 'Bookstore': 39, 'Car stereo store': 38, 'Kitchen supply store': 37, 'Kosher restaurant': 37, 'T-shirt store': 37, 'Shopping mall': 36, 'Game store': 36, 'Candy store': 35, 'Takeout Restaurant': 34, 'Buffet restaurant': 34, 'Bakery': 34, 'Stationery store': 33, 'Art supply store': 33, 'Latin American restaurant': 33, 'Used clothing store': 33, 'Swimwear store': 33, 'Leather goods store': 32, 'Antique furniture store': 32, 'Deli': 32, 'Gourmet grocery store': 31, 'Greek restaurant': 31, 'Asian grocery store': 31, 'Aircraft supply store': 30, 'Guatemalan restaurant': 30, 'Comic book store': 30, 'Boutique': 30, 'Record store': 30, 'Adult entertainment store': 30, 'Packaging supply store': 30, 'Sunglasses store': 30, 'Camera store': 29, 'Armenian restaurant': 28, 'Watch store': 28, 'Traditional American restaurant': 28, 'Hot dog restaurant': 28, 'Tropical fish store': 27, 'Soccer store': 27, 'Soul food restaurant': 27, 'Pizza delivery': 26, 'Hobby store': 26, 'Outlet store': 25, 'Swimming pool supply store': 24, 'Middle Eastern restaurant': 24, 'Brazilian restaurant': 24, 'General store': 23, 'Fireplace store': 22, 'Collectibles store': 22, 'Cuban restaurant': 22, 'Bar': 22, 'Used appliance store': 22, 'Luggage store': 22, 'Outdoor furniture store': 21, 'Fishing store': 21, 'Yarn store': 21, 'Lumber store': 21, 'Convenience Store': 21, 'Office furniture store': 20, 'Metaphysical supply store': 20, 'Religious goods store': 20, 'Pharmacy': 20, 'Rug store': 20, 'Tool store': 19, 'Organic restaurant': 19, 'Home audio store': 19, 'Candle store': 19, 'Brunch restaurant': 19, 'Animal feed store': 19, 'Custom t-shirt store': 19, 'Building materials store': 18, 'Video store': 18, 'Dance store': 18, 'Exercise equipment store': 18, 'Jamaican restaurant': 18, 'Taiwanese restaurant': 18, 'Used book store': 17, 'Used furniture store': 17, 'Cheesesteak restaurant': 17, 'Home theater store': 17, 'Off Licence': 17, 'Sports bar': 17, 'Plus size clothing store': 16, 'Fine dining restaurant': 16, 'Marine supply store': 16, 'Halal restaurant': 16, 'Argentinian restaurant': 15, 'Cabinet store': 15, 'Ethiopian restaurant': 15, 'Tex-Mex restaurant': 14, 'Jeweler': 14, 'Gift basket store': 14, 'Beer store': 14, 'Bistro': 14, 'Bathroom supply store': 13, 'Wallpaper store': 13, 'Western apparel store': 13, 'Lebanese restaurant': 13, 'Martial arts supply store': 13, 'Natural goods store': 13, 'Computer software store': 13, 'Bead store': 13, 'Consignment shop': 13, 'Tire shop': 12, 'Spanish restaurant': 12, 'Vegetarian restaurant': 12, 'African goods store': 11, 'Wedding store': 11, 'Souvenir store': 11, 'Honduran restaurant': 11, 'Tobacco shop': 11, 'Boot store': 11, 'Eclectic restaurant': 11, 'Japanese grocery store': 11, 'Hot pot restaurant': 11, 'Truck accessories store': 10, 'Second hand store': 10, 'Colombian restaurant': 10, 'Snack bar': 10, 'Cajun restaurant': 10, 'Kosher grocery store': 10, 'Herbal medicine store': 10, 'Salad shop': 10, 'Outdoor sports store': 10, 'Dress store': 10, 'Balloon store': 10, 'Pottery store': 10, 'Baby clothing store': 10, 'Juice shop': 10, 'Maternity store': 10, 'Donut shop': 10, 'Brewpub': 10, 'Wheel store': 10, 'Roofing supply store': 9, 'Countertop store': 9, 'Novelty store': 9, 'Piano store': 9, 'Guitar store': 9, 'Gun shop': 9, 'Wine bar': 9, 'Christian book store': 9, 'Indian grocery store': 9, 'Russian restaurant': 9, 'Used computer store': 9, 'Vacuum cleaner store': 9, 'Korean grocery store': 9, 'Dim sum restaurant': 9, 'Linens store': 9, 'Movie rental store': 8, 'Caribbean restaurant': 8, 'Sports nutrition store': 8, 'Spice store': 8, 'Orthopedic shoe store': 8, 'Garden center': 8, 'Irish pub': 8, 'Bedroom furniture store': 8, 'Pen store': 8, 'Hat shop': 8, 'Bedding store': 8, 'Creole restaurant': 8, 'German restaurant': 8, 'Flag store': 8, 'Grill': 7, 'Car battery store': 7, 'Landscaping supply store': 7, 'Wig shop': 7, 'Photo shop': 7, 'Burglar alarm store': 7, 'Running store': 7, 'Sports card store': 7, 'Christmas store': 7, 'Jewelry designer': 7, 'Southeast Asian restaurant': 7, 'Authentic Japanese restaurant': 7, 'Dental supply store': 7, 'Conveyor belt sushi restaurant': 7, 'Modern European restaurant': 7, 'Health and beauty shop': 7, 'Northern Italian restaurant': 7, 'Educational supply store': 7, 'Mall': 7, 'Welding supply store': 7, 'Cantonese restaurant': 7, 'Trading card store': 7, 'Motorcycle parts store': 7, 'Mexican goods store': 7, 'Surplus store': 7, 'Cocktail bar': 7, 'Lunch restaurant': 7, 'Warehouse store': 6, 'Camping store': 6, 'Modern French restaurant': 6, 'Delivery Restaurant': 6, 'Brewery': 6, 'Banquet hall': 6, 'Corporate office': 6, 'Police supply store': 6, 'Gas station': 6, 'Pakistani restaurant': 6, 'Grill store': 6, 'Food store': 6, 'Picture frame shop': 6, 'Pub': 6, 'Tennis store': 6, 'Butcher shop': 6, 'Seafood market': 6, 'Work clothes store': 6, 'Shabu-shabu restaurant': 6, 'Izakaya restaurant': 6, 'Dumpling restaurant': 6, 'Hong Kong style fast food restaurant': 6, 'Pan-Asian restaurant': 5, 'Surf shop': 5, 'Mongolian barbecue restaurant': 5, 'Bird shop': 5, 'Banner store': 5, 'Nut store': 5, 'Hot tub store': 5, 'Down home cooking restaurant': 5, 'Lounge': 5, 'Futon store': 5, 'Barber supply store': 5, 'Print shop': 5, 'Woodworking supply store': 5, 'Bubble tea store': 5, 'Miniatures store': 5, 'Charity shop': 5, 'Childrens store': 5, 'Gluten-free restaurant': 5, 'Florist': 5, 'Aromatherapy supply store': 5, 'Bridal shop': 5, 'Bus stop': 5, 'Wholesaler': 5, 'Fruit and vegetable store': 5, 'Central American restaurant': 5, 'Nicaraguan restaurant': 5, 'Doll store': 5, 'Indonesian restaurant': 5, 'Self-storage facility': 5, 'School supply store': 5, 'Caterer': 4, 'DVD store': 4, 'Produce market': 4, 'Formal wear store': 4, 'Airport': 4, 'Pizza Takeout': 4, 'Sichuan restaurant': 4, 'Market': 4, 'Moving supply store': 4, 'DJ supply store': 4, 'Sri Lankan restaurant': 4, 'Lawn mower store': 4, 'Dairy store': 4, 'Reptile store': 4, 'Israeli restaurant': 4, 'Skate shop': 4, 'Pho restaurant': 4, 'Pretzel store': 4, 'Oriental rug store': 4,
            'Brewing supply store': 4, 'Event venue': 4, 'Battery store': 4, 'Noodle shop': 4, 'Interior designer': 4, 'Oyster bar restaurant': 4, 'Massage supply store': 4, 'Wine shop': 4, 'Chinese noodle restaurant': 4, 'Shanghainese restaurant': 4, 'Gift wrap store': 4, 'Japanese curry restaurant': 4, 'Rare book store': 4, 'Magic store': 4, 'Chemist': 4, 'Manufacturer': 4, 'Golf shop': 4, 'Screen printing supply store': 4, 'Business center': 4, 'Used auto parts store': 3, 'Hookah bar': 3, 'Scrapbooking store': 3, 'Stores and shopping': 3, 'Herb shop': 3, 'Coffee store': 3, 'Baking supply store': 3, 'Used office furniture store': 3, 'African restaurant': 3, 'Belgian restaurant': 3, 'Hearing aid store': 3, 'Delivery Chinese restaurant': 3, 'Falafel restaurant': 3, 'Chocolate shop': 3, 'E-commerce service': 3, 'Afghani restaurant': 3, 'Car accessories store': 3, 'Hot dog stand': 3, 'Music school': 3, 'Billiards supply store': 3, 'Beer garden': 3, 'Tack shop': 3, 'Native american goods store': 3, 'Upholstery shop': 3, 'Cigar shop': 3, 'Popcorn store': 3, 'Dessert restaurant': 3, 'Aquarium shop': 3, 'Fusion restaurant': 3, 'Airsoft supply store': 3, 'Ecuadorian restaurant': 3, 'Night club': 3, 'West African restaurant': 3, 'Fried chicken takeaway': 3, 'Drum store': 3, 'Moroccan restaurant': 3, 'Yakiniku restaurant': 3, 'Cutlery store': 3, 'Burmese restaurant': 3, 'Food products supplier': 3, 'Greeting card shop': 3, 'English restaurant': 3, 'Rice restaurant': 3, 'Food court': 3, 'Cell phone accessory store': 3, 'Continental restaurant': 3, 'British restaurant': 3, 'Map store': 3, 'Tea store': 3, 'Mexican torta restaurant': 3, 'Crêperie': 3, 'Sewing shop': 2, 'Oaxacan restaurant': 2, 'Festival': 2, 'Natural Foods Shop': 2, 'Poster store': 2, 'Trophy shop': 2, 'Kebab shop': 2, 'Small plates restaurant': 2, 'Grocery delivery service': 2, 'Unfinished furniture store': 2, 'Model train store': 2, 'Puerto Rican restaurant': 2, 'Rustic furniture store': 2, 'East African restaurant': 2, 'Syrian restaurant': 2, 'Sofa store': 2, 'Modern izakaya restaurants': 2, 'Tapas bar': 2, 'Fence supply store': 2, 'Sports memorabilia store': 2, 'Flea market': 2, 'Chilean restaurant': 2, 'Dinner theater': 2, 'Skateboard shop': 2, 'Sign shop': 2, 'Motorsports store': 2, 'RV supply store': 2, 'Organic shop': 2, 'Theater': 2, 'Electric motor store': 2, 'Professional services': 2, 'Community center': 2, 'Audio visual equipment supplier': 2, 'Bathroom remodeler': 2, 'Fabric product manufacturer': 2, 'Polish restaurant': 2, 'Australian restaurant': 2, 'University department': 2, 'Bagel shop': 2, 'Movie theater': 2, 'Chinese takeaway': 2, 'Bus station': 2, 'Shipping company': 2, 'Auto repair shop': 2, 'Mexican Grocers': 2, 'Singaporean restaurant': 2, 'Tile contractor': 2, 'Toyota dealer': 2, 'Sukiyaki and Shabu Shabu restaurant': 2, 'Association or organization': 2, 'Fireworks store': 2, 'Malaysian restaurant': 2, 'Bar restaurant furniture store': 2, 'South Asian restaurant': 2, 'Sundae restaurant': 2, 'Jazz club': 2, 'Udon noodle restaurant': 2, 'Kitchen furniture store': 2, 'Southern Italian restaurant': 2, 'Garden furniture shop': 2, 'Car repair and maintenance': 2, 'Surgical supply store': 2, 'Wheelchair store': 2, 'European restaurant': 2, 'Yakitori restaurant': 2, 'Tofu restaurant': 2, 'Okonomiyaki restaurant': 2, 'Cheese shop': 2, 'Cafeteria': 2, 'Bicycle repair shop': 2, 'Irish restaurant': 2, 'Tapas restaurant': 2, 'Apartment complex': 2, 'Refrigerator store': 2, 'Embroidery shop': 2, 'CD store': 2, 'Italian grocery store': 2, 'Mandarin restaurant': 2, 'Needlework shop': 2, 'Shelving store': 2, 'Cambodian restaurant': 2, 'Pound Shop': 2, 'Bangladeshi restaurant': 2, 'Racing car parts store': 2, 'Industrial equipment supplier': 2, 'Appliance repair service': 2, 'Beauty salon': 2, 'Buddhist supplies store': 1, 'Gourmet Grocery Shop': 1, 'Jewelry buyer': 1, 'BMW motorcycle dealer': 1, 'Cinema equipment supplier': 1, 'Food producer': 1, 'Golf course': 1, 'Gold dealer': 1, 'Hungarian restaurant': 1, 'Equipment rental agency': 1, 'Paintball store': 1, 'Non-profit organization': 1, 'South American restaurant': 1, 'Chicken shop': 1, 'Charity': 1, 'Modern Indian restaurant': 1, 'Lighting wholesaler': 1, 'Make-up artist': 1, 'Shopping Centre': 1, 'Medical clinic': 1, 'Pancake restaurant': 1, 'Wood and laminate flooring supplier': 1, 'Engineer': 1, 'Silk plant shop': 1, 'Dart supply store': 1, 'South African restaurant': 1, 'Screen store': 1, 'Appliance parts supplier': 1, 'Chimney services': 1, 'Pet boarding service': 1, 'Couture store': 1, 'Check cashing service': 1, 'Catering food and drink supplier': 1, 'Motorcycle shop': 1, 'Discount shop': 1, 'Soup shop': 1, 'Dance school': 1, 'BMW dealer': 1, 'Music box store': 1, 'Sukiyaki restaurant': 1, 'Kashmiri restaurant': 1, 'Curtain store': 1, 'Diamond dealer': 1, 'Hairdresser': 1, 'Optician': 1, 'Audio visual consultant': 1, 'Coffee Shop': 1, 'Beach clothing store': 1, 'Adult DVD store': 1, 'Flamenco dance store': 1, 'Dried seafood store': 1, 'Kitchen remodeler': 1, 'Sports equipment rental service': 1, 'Duty free store': 1, 'Computer accessories store': 1, 'Homeopath': 1, 'Neighborhood': 1, 'Dive shop': 1, 'Tailor': 1, 'Baseball goods store': 1, 'BBQ area': 1, 'Takoyaki restaurant': 1, 'Tonkatsu restaurant': 1, 'Video karaoke': 1, 'Pasta shop': 1, 'Hair extensions supplier': 1, 'Seasonal goods store': 1, 'University': 1, 'Contemporary Louisiana restaurant': 1, 'Mailing service': 1, 'Paintings store': 1, 'Fish store': 1, 'Hotel supply store': 1, 'Art gallery': 1, 'Macrobiotic restaurant': 1, 'Art museum': 1, 'Kosher Food Shop': 1, 'Sweet shop': 1, 'Pawn shop': 1, 'Fish and chips takeaway': 1, 'Foam rubber supplier': 1, 'Plumber': 1, 'Snowboard shop': 1, 'Live music bar': 1, 'Burrito restaurant': 1, 'Pool hall': 1, 'Sicilian restaurant': 1, 'Tempura restaurant': 1, 'Dessert shop': 1, 'Magazine store': 1, 'Jewish restaurant': 1, 'Furniture accessories': 1, 'Parking lot': 1, 'Country food restaurant': 1, 'Crab house': 1, 'Frozen yogurt shop': 1, 'Rainwater tank supplier': 1, 'Handicraft': 1, 'Live music venue': 1, 'Invitation printing service': 1, 'Animal shelter': 1, 'Childrens cafe': 1, 'Publisher': 1, 'Karaoke bar': 1, 'Underwear store': 1, 'Medical center': 1, 'Brasserie': 1, 'Books wholesaler': 1, 'Jewelry repair service': 1, 'Violin shop': 1, 'Talent agency': 1, 'Camera repair shop': 1, 'Swedish restaurant': 1, 'Appliances': 1, 'Golf club': 1, 'Youth clothing store': 1, 'Shopping center': 1, 'Traditional restaurant': 1, 'Italian Food Shop': 1, 'Religious book store': 1, 'Electrical wholesaler': 1, 'Dry wall supply store': 1, 'Romanian restaurant': 1, 'Hookah store': 1, 'Country club': 1, 'Wholesale bakery': 1, 'Window installation service': 1, 'Takeaway': 1, 'Kitchen supply shop': 1, 'Venezuelan restaurant': 1, 'Nepalese restaurant': 1, 'Recreation center': 1, 'Used musical instrument store': 1, 'Martial arts school': 1, 'Variety Shop': 1, 'Chinese medicine store': 1, 'Shandong restaurant': 1, 'Hunan restaurant': 1, 'Equipment supplier': 1, 'Fabric wholesaler': 1, 'Salvage yard': 1, 'Bicycle Shop': 1, 'Student housing center': 1, 'Shop supermarket furniture store': 1, 'Museum': 1, 'Japanese supermarket': 1, 'Skyscraper': 1, 'Legal services': 1, 'Concert hall': 1, 'Notary public': 1, 'Winery': 1, 'Medical book store': 1, 'Musical instrument repair shop': 1, 'Dentist': 1, 'Syokudo and Teishoku restaurant': 1, 'Bag shop': 1, 'Church supply store': 1, 'Historical landmark': 1, 'Club': 1, 'Raw food restaurant': 1, 'North African restaurant': 1, 'Store equipment supplier': 1, 'Mutton barbecue restaurant': 1, 'Tamale shop': 1, 'Produce wholesaler': 1, 'General hospital': 1, 'Preschool': 1, 'Trucking company': 1, 'Oil refinery': 1, 'Security guard service': 1, 'Dental clinic': 1, 'Go-kart track': 1, 'Masonry supply store': 1, 'Car alarm supplier': 1, 'Furnace store': 1, 'Pizza takeaway': 1, 'Bait shop': 1, 'Computer repair service': 1, 'Entertainer': 1, 'Mexican Goods Shop': 1, 'Furniture rental service': 1, 'Beauty product supplier': 1, 'Trailer supply store': 1, 'Pet groomer': 1, 'Fruit and vegetable shop': 1, 'Sewing machine store': 1, 'Turkmen restaurant': 1, 'Airbrushing service': 1, 'Handbags shop': 1, 'Japanese steakhouse': 1, 'Medical office': 1, 'Childrens book store': 1, 'Mobile phone repair shop': 1, 'Antique furniture restoration service': 1, 'Pet Shop': 1, 'Pizza Takeaway': 1, 'Bottled water supplier': 1, 'Polynesian restaurant': 1, 'Plant nursery': 1, 'Used CD store': 1, 'Adult entertainment club': 1, 'Outdoor clothing and equipment shop': 1, 'Bowling supply shop': 1, 'Wholesale jeweler': 1, 'Warehouse': 1, 'Bowling alley': 1, 'Goldsmith': 1, 'Chiropractor': 1, 'Fashion designer': 1}
INSEMBLE = {'Mexican Restaurant': 1289, 'Fast Food Restaurant': 924, 'Pizza Place': 897, 'Automotive Shop': 747, 'Pharmacy': 701, 'Sandwich Place': 647, 'Coffee Shop': 609, 'Chinese Restaurant': 573, 'Mobile Phone Shop': 522, 'Burger Joint': 499, 'American Restaurant': 481, 'Bakery': 449, 'Clothing Store': 402, 'Sushi Restaurant': 396, 'Grocery Store': 374, 'Restaurant': 374, 'Italian Restaurant': 369, 'Furniture / Home Store': 365, 'Japanese Restaurant': 360, 'Convenience Store': 345, 'Auto Dealership': 342, 'Miscellaneous Shop': 341, 'Office': 332, 'Thai Restaurant': 331, 'Hardware Store': 329, 'Jewelry Store': 328, 'Café': 324, 'Asian Restaurant': 298, 'Taco Place': 297, 'Food': 286, 'Building': 284, 'Korean Restaurant': 277, 'Seafood Restaurant': 270, 'Fried Chicken Joint': 226, 'Mediterranean Restaurant': 223, 'Construction & Landscaping': 217, 'Gas Station': 215, 'Liquor Store': 215, 'Donut Shop': 213, 'Cosmetics Shop': 208, 'Shoe Store': 200, 'Ice Cream Shop': 200, 'Video Store': 178, 'Latin American Restaurant': 174, 'Breakfast Spot': 165, 'Home Service': 162, 'Boutique': 162, 'Juice Bar': 162, 'Food Truck': 161, 'Diner': 154, 'Shipping Store': 152, 'Pet Store': 151, 'Smoke Shop': 150, 'Bar': 150, 'Supermarket': 145, 'Electronics Store': 143, 'Flower Shop': 142, 'Gift Shop': 138, 'Salon / Barbershop': 138, 'Indian Restaurant': 134, 'Deli / Bodega': 133, 'Storage Facility': 132, 'New American Restaurant': 130, "Women's Store": 127, 'Middle Eastern Restaurant': 127, 'BBQ Joint': 126, 'Vietnamese Restaurant': 124, 'Sporting Goods Shop': 123, 'Department Store': 120, 'Discount Store': 115, "Doctor's Office": 112, 'Big Box Store': 111, 'Other Repair Shop': 110, 'Print Shop': 105, 'Dessert Shop': 105, 'Arts & Crafts Store': 104, 'Vegetarian / Vegan Restaurant': 102, 'Wings Joint': 97, 'Paper / Office Supplies Store': 97, 'Thrift / Vintage Store': 94, 'Design Studio': 90, 'Wine Bar': 89, 'Medical Center': 87, 'Business Service': 83, 'Poke Place': 83, 'Optical Shop': 81, 'Accessories Store': 81, 'Ramen Restaurant': 81, 'Steakhouse': 78, 'Bookstore': 77, 'Salad Place': 76, 'General Entertainment': 73, "Dentist's Office": 72, 'Bike Shop': 71, 'Warehouse Store': 70, 'Music Store': 69, "Men's Store": 68, 'French Restaurant': 67, 'Gastropub': 65, 'Factory': 64, 'Hot Dog Joint': 64, 'Music Venue': 64, 'Noodle House': 64, 'Snack Place': 63, 'Tattoo Parlor': 63, 'Market': 61, 'Kids Store': 61, 'Shopping Mall': 60, 'Health & Beauty Service': 58, 'Antique Shop': 57, 'Bagel Shop': 56, 'Toy / Game Store': 56, 'Frozen Yogurt Shop': 53, 'Filipino Restaurant': 51, 'Church': 47, 'Spa': 47, 'Hobby Shop': 47, 'Financial or Legal Service': 45, 'Supplement Shop': 44, 'Art Gallery': 43, 'Food & Drink Shop': 43, 'Food Court': 42, 'Event Space': 41, 'Hawaiian Restaurant': 40, 'South American Restaurant': 39, 'Cocktail Bar': 38, 'Mattress Store': 37, 'Candy Store': 36, 'Video Game Store': 36, 'Butcher': 35, 'Greek Restaurant': 34, 'Hotel': 34, 'Southern / Soul Food Restaurant': 34, 'Sports Bar': 33, 'Pub': 32, 'Peruvian Restaurant': 32, 'Marijuana Dispensary': 31, 'Bubble Tea Shop': 31, 'Cajun / Creole Restaurant': 31, 'Lounge': 31, 'Bank': 30, 'Rental Service': 30, 'Wine Shop': 29, 'Bridal Shop': 28, 'Coworking Space': 28, 'Burrito Place': 28, 'Brewery': 27, 'Recording Studio': 27, 'Caribbean Restaurant': 27, 'Lingerie Store': 26, 'Laundry Service': 26, 'Kitchen Supply Store': 25, 'Arcade': 25, 'Buffet': 25, 'Cuban Restaurant': 25, 'Nail Salon': 25, 'Tea Room': 25, 'Shopping Plaza': 24, 'Pet Service': 24, 'Gym / Fitness Center': 23, 'Music School': 23, 'Board Shop': 23, 'Brazilian Restaurant': 23, 'Fabric Shop': 21, 'Food Stand': 21, 'Garden Center': 21, 'Donburi Restaurant': 21, 'Yoga Studio': 21, 'Medical Supply Store': 20, 'Post Office': 20, 'Elementary School': 19, 'Motorcycle Shop': 19, 'Tech Startup': 19, 'Carpet Store': 19, 'Kosher Restaurant': 19, 'Bowling Alley': 19, 'Photography Lab': 18, 'Auto Garage': 18, 'Record Shop': 18, 'Auto Workshop': 17, 'Business Center': 17, 'Eye Doctor': 17, 'Shop & Service': 17, 'Chiropractor': 17, 'Lawyer': 17, 'Hotel Bar': 17, 'Hookah Bar': 16, 'Gym': 16, 'Salvadoran Restaurant': 16, 'Health Food Store': 16, 'Dive Bar': 15, 'Farmers Market': 15, 'Falafel Restaurant': 15, 'Persian Restaurant': 15, 'Gourmet Shop': 15, 'Dim Sum Restaurant': 15, 'Professional & Other Places': 14, 'Comfort Food Restaurant': 14, 'Beer Garden': 14, 'Tailor Shop': 14, 'Spanish Restaurant': 14, 'Argentinian Restaurant': 14, 'Halal Restaurant': 14, 'Dumpling Restaurant': 14, 'Lighting Store': 13, 'Warehouse': 13, 'Frame Store': 13, 'Nightlife Spot': 13, 'Camera Store': 13, 'Comic Shop': 13, 'School': 13, 'Moving Target': 13, 'Veterinarian': 13, 'Speakeasy': 13, 'Karaoke Bar': 13, 'Distribution Center': 12, 'Nightclub': 12, 'College Bookstore': 12, 'Advertising Agency': 12, 'Bistro': 12, 'Car Wash': 12, 'Golf Course': 12, 'Movie Theater': 12, 'Rental Car Location': 11, 'High School': 11, 'IT Services': 11, 'Dance Studio': 11, 'Performing Arts Venue': 11, 'Cupcake Shop': 11, 'Parking': 11, 'Pawn Shop': 11, 'Real Estate Office': 11, 'Hospital': 11, 'Fish & Chips Shop': 11, 'Ethiopian Restaurant': 11, 'Watch Shop': 10, 'Government Building': 10, 'Luggage Store': 10, 'Concert Hall': 10, 'Acupuncturist': 10, 'Tex-Mex Restaurant': 10, 'Food Service': 10,
            'Smoothie Shop': 10, 'Taiwanese Restaurant': 10, 'Museum': 10, 'Irish Pub': 10, 'Credit Union': 9, 'Mongolian Restaurant': 9, 'Newsstand': 9, 'Garden': 9, 'Cheese Shop': 9, 'Creperie': 9, 'Playground': 9, 'University': 9, 'German Restaurant': 9, 'Costume Shop': 8, 'Vape Store': 8, 'Bus Line': 8, 'Spiritual Center': 8, 'Locksmith': 8, 'College Cafeteria': 8, 'Cafeteria': 8, 'Insurance Office': 8, 'Other Great Outdoors': 8, 'Martial Arts Dojo': 8, 'Park': 8, 'Hotpot Restaurant': 8, 'Perfume Shop': 8, 'General College & University': 8, 'Student Center': 8, 'African Restaurant': 7, 'Flea Market': 7, 'Medical School': 7, 'Transportation Service': 7, 'Event Service': 7, 'Historic Site': 7, 'Russian Restaurant': 7, 'Dry Cleaner': 7, 'Eastern European Restaurant': 7, 'Beer Bar': 7, 'Shabu-Shabu Restaurant': 7, 'Szechuan Restaurant': 7, 'Indonesian Restaurant': 7, 'General Travel': 6, 'Outdoor Supply Store': 6, 'Other Nightlife': 6, 'Gun Shop': 6, 'Trade School': 6, 'Leather Goods Store': 6, 'Urgent Care Center': 6, 'Baby Store': 6, 'Adult Boutique': 6, 'Chocolate Shop': 6, 'Funeral Home': 6, 'Astrologer': 6, 'Sake Bar': 6, 'Non-Profit': 6, 'Udon Restaurant': 6, 'Athletics & Sports': 6, 'Cantonese Restaurant': 6, 'Strip Club': 5, 'Monument / Landmark': 5, 'Kebab Restaurant': 5, 'College Classroom': 5, 'Farm': 5, 'Pakistani Restaurant': 5, 'Bike Rental / Bike Share': 5, 'Conference Room': 5, 'Soup Place': 5, 'English Restaurant': 5, 'Himalayan Restaurant': 5, 'Surf Spot': 5, 'Japanese Curry Restaurant': 5, 'Laundromat': 5, 'Jazz Club': 5, 'Courthouse': 5, 'Herbs & Spices Store': 4, 'Dog Run': 4, 'Winery': 4, 'Theater': 4, 'Gluten-free Restaurant': 4, 'Bus Stop': 4, 'Stationery Store': 4, 'Fruit & Vegetable Store': 4, 'Lebanese Restaurant': 4, 'Tapas Restaurant': 4, 'Pool': 4, 'Photography Studio': 4, 'Massage Studio': 4, 'Australian Restaurant': 4, 'Fishing Store': 4, 'Pop-Up Shop': 4, 'Film Studio': 4, 'Rock Club': 4, 'Currency Exchange': 4, 'Organic Grocery': 4, 'Theme Restaurant': 4, 'Gay Bar': 4, 'Pie Shop': 4, 'Nursery School': 4, 'Library': 4, 'Mental Health Office': 4, 'Alternative Healer': 3, 'Entertainment Service': 3, 'Pool Hall': 3, 'Empanada Restaurant': 3, 'Gaming Cafe': 3, 'Beer Store': 3, 'College Administrative Building': 3, 'Fish Market': 3, 'Airport Service': 3, 'Doner Restaurant': 3, 'Convention Center': 3, 'Sri Lankan Restaurant': 3, 'Bridge': 3, 'Tennis Court': 3, 'Rest Area': 3, 'Airport Terminal': 3, 'Afghan Restaurant': 3, 'Daycare': 3, 'ATM': 3, 'Baseball Field': 3, 'Pilates Studio': 3, 'Theme Park Ride / Attraction': 3, 'Beach': 3, 'Skating Rink': 3, 'Casino': 3, 'Temple': 3, 'Art Museum': 3, 'Moroccan Restaurant': 3, 'Modern European Restaurant': 3, 'Motel': 3, 'Arts & Entertainment': 3, 'Souvenir Shop': 3, 'Community Center': 3, 'Shanghai Restaurant': 3, 'Plaza': 3, 'Skate Park': 3, 'Outlet Store': 2, 'Indie Movie Theater': 2, 'Piercing Parlor': 2, 'Sculpture Garden': 2, 'North Indian Restaurant': 2, 'Bus Station': 2, 'Knitting Store': 2, 'Art Studio': 2, 'Music Festival': 2, 'Recycling Facility': 2, 'Dive Shop': 2, 'South Indian Restaurant': 2, 'Recreation Center': 2, 'Paella Restaurant': 2, 'Scenic Lookout': 2, 'Beach Bar': 2, 'Polish Restaurant': 2, 'Bay': 2, 'Pier': 2, 'River': 2, 'Harbor / Marina': 2, 'Airport': 2, 'Multiplex': 2, 'Campground': 2, 'Gun Range': 2, 'Street Food Gathering': 2, 'Roof Deck': 2, 'Gymnastics Gym': 2, 'Pedestrian Plaza': 2, 'College Residence Hall': 2, 'History Museum': 2, 'Jewish Restaurant': 2, 'Cultural Center': 2, 'TV Station': 2, 'Venezuelan Restaurant': 2, 'Fireworks Store': 2, 'Tanning Salon': 2, 'Dongbei Restaurant': 2, 'College Academic Building': 2, 'Burmese Restaurant': 2, 'Bed & Breakfast': 2, 'Drugstore': 1, 'Waterfall': 1, 'RV Park': 1, 'Motorsports Shop': 1, 'Aquarium': 1, 'Paintball Field': 1, 'Corporate Coffee Shop': 1, 'Recruiting Agency': 1, 'Fishing Spot': 1, 'Other Event': 1, 'Shawarma Place': 1, 'Radio Station': 1, 'Floating Market': 1, 'Lottery Retailer': 1, 'Middle School': 1, 'College Rec Center': 1, 'Fountain': 1, 'Country Dance Club': 1, 'Check Cashing Service': 1, 'Emergency Room': 1, 'Hunting Supply': 1, 'Mosque': 1, 'Pastry Shop': 1, 'Trail': 1, 'Boat Rental': 1, 'Hostel': 1, 'Skate Shop': 1, 'Internet Cafe': 1, 'Dive Spot': 1, 'Malay Restaurant': 1, 'Churrascaria': 1, 'Boat or Ferry': 1, 'Weight Loss Center': 1, 'College Quad': 1, 'College Auditorium': 1, 'Theme Park': 1, 'Social Club': 1, 'Comedy Club': 1, 'Maternity Clinic': 1, 'Portuguese Restaurant': 1, 'Resort': 1, 'Cemetery': 1, 'Adult Education Center': 1, 'Fire Station': 1, 'Platform': 1, 'Law School': 1, 'Iraqi Restaurant': 1, 'Baseball Stadium': 1, 'Police Station': 1, 'Indoor Play Area': 1, 'Cooking School': 1, 'Used Bookstore': 1, 'Meeting Room': 1, 'Piano Bar': 1, 'Brasserie': 1, 'Animal Shelter': 1, 'Sports Club': 1, 'Preschool': 1, 'Cable Car': 1, 'Cha Chaan Teng': 1, 'Hunan Restaurant': 1, 'College Basketball Court': 1, 'Soccer Field': 1, 'Train Station': 1, 'Yoshoku Restaurant': 1, 'Boarding House': 1, 'Corporate Cafeteria': 1, 'College Library': 1, 'Club House': 1, 'Opera House': 1, 'Waste Facility': 1, 'Distillery': 1, 'Notary': 1, 'Outlet Mall': 1, 'Light Rail Station': 1, 'Private School': 1, 'Child Care Service': 1, 'Kingdom Hall': 1, 'Language School': 1, 'Racetrack': 1}


def generate_comparison():
    # with open(THIS_DIR + '/terminal_categories.pkl', 'rb') as f:
    #     pickle.load(terminal, f)

    # with open(THIS_DIR + '/insemble_categories.pkl', 'rb') as f:
    #     pickle.load(insemble, f)
    terminal = {k.lower(): v for k, v in TERMINAL.items()}
    terminal_keys = list(terminal.keys())
    insemble = {k.lower(): v for k, v in INSEMBLE.items()}
    insemble_keys = list(insemble.keys())
    keys = set(terminal_keys + insemble_keys)

    data = []
    for category in keys:
        terminal_key = process.extractOne(category, terminal_keys, score_cutoff=95)
        insemble_key = process.extractOne(category, insemble_keys, score_cutoff=95)
        terminal_category_count = terminal[terminal_key[0]] if terminal_key else None
        insemble_category_count = insemble[insemble_key[0]] if insemble_key else None
        diff = insemble_category_count or 0
        if terminal_category_count:
            diff = diff - terminal_category_count

        row = {
            'category': category,
            'terminal_category_name': terminal_key[0] if terminal_key else None,
            'terminal_category_count': terminal_category_count,
            'insemble_category_name': insemble_key[0] if insemble_key else None,
            'insemble_category_count': insemble_category_count,
            'diff': diff
        }
        data.append(row)

    pd.DataFrame(data).sort_values(by=['diff'], ascending=False).to_csv(THIS_DIR + '/categorydiff.csv')


def update_all_categories():

    # Will not work until we have mongodb 4.2 installed on remote mongodb database

    sorted_types = list(utils.DB_TERMINAL_PLACES.aggregate([
        {'$match': {'google_details': {'$exists': True}}},
        {'$addFields': {
            'type': {
                '$arrayElemAt': [
                    {
                        '$split': [
                            '$google_details.type', ' in '
                        ]
                    }, 0
                ]
            }
        }},
        # {'$limit': 100},
        # {'$out': "test_aggregation"}
        {'$merge': "places"}
    ]))
    print(sorted_types)


def update_categories():

    # region = utils.DB_REGIONS.find_one({'name': {"$regex": "^Los.*"}, 'type': 'city-box'})

    while True:

        pipeline = [
            {'$match': {
                'type': {'$exists': False},
                'google_details': {'$exists': True},
                'google_details.type': {'$ne': None},
                # 'location': {'$geoWithin': {'$geometry': region['geometry']}}
            }},
            {'$sample': {'size': 2000}}
        ]

        locations = list(utils.DB_TERMINAL_PLACES.aggregate(pipeline))

        count = 0
        for location in locations:
            my_type = utils.modify_word(location['google_details']['type'].split(" in ")[0])
            location['type'] = my_type
            utils.DB_TERMINAL_PLACES.update_one({'_id': location['_id']}, {'$set': {
                'type': my_type
            }})
            count += 1
            if count % 500 == 0:
                print("{} updated in this batch.".format(count))


if __name__ == "__main__":
    # generate_comparison()
    # pd.read_csv(THIS_DIR + '/categorydiff.csv').sort_values(
    #     by=['diff'],
    #     ascending=False
    # ).set_index('category').to_csv(THIS_DIR + '/sortedcategorydiff.csv')

    # print(sum(INSEMBLE.values()))
    # print(sum(TERMINAL.values()))

    update_categories()
