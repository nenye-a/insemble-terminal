# Migration `20200605141110-user-role-and-license`

This migration has been generated by RaymondAnggara at 6/5/2020, 2:11:10 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."License" (
    "id" text  NOT NULL ,
    "masterLicense" text  NOT NULL ,
    "user" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."MasterLicense" (
    "id" text  NOT NULL ,
    "maxLicense" integer  NOT NULL DEFAULT 0,
    "name" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."User" ADD COLUMN "role" text  NOT NULL DEFAULT 'USER';

CREATE UNIQUE INDEX "License_user" ON "public"."License"("user")

ALTER TABLE "public"."License" ADD FOREIGN KEY ("masterLicense") REFERENCES "public"."MasterLicense"("id") ON DELETE RESTRICT

ALTER TABLE "public"."License" ADD FOREIGN KEY ("user") REFERENCES "public"."User"("id") ON DELETE SET NULL
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200603135053-terminal-init..20200605141110-user-role-and-license
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -50,8 +50,13 @@
   PROPERTY
   COMPANY
 }
+enum UserRole {
+  ADMIN
+  USER
+}
+
 model LocationTag {
   id     String          @default(cuid()) @id
   type   LocationTagType
   params String
@@ -77,8 +82,21 @@
   createdAt   DateTime     @default(now())
   updatedAt   DateTime     @updatedAt
 }
+model License {
+  id            String @default(cuid()) @id
+  masterLicense MasterLicense
+  user          User?
+}
+
+model MasterLicense {
+  id         String    @default(cuid()) @id
+  name       String
+  maxLicense Int
+  licenses   License[]
+}
+
 model User {
   id           String      @default(cuid()) @id
   email        String      @unique
   avatar       String?
@@ -88,9 +106,11 @@
   company      String
   title        String?
   description  String?
   address      String?
-  terminals    Terminal[]     
+  terminals    Terminal[]
+  role         UserRole    @default(USER)
+  license      License?
   searchLog    SearchLog[]
   pendingEmail Boolean     @default(false)
   createdAt    DateTime    @default(now())
 }
```


